@{
    ViewBag.Title = "Test";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@section style{
    <link href="../../Content/my/pagination.css" rel="stylesheet" type="text/css" />
}
<div class="content">
    <div class="header">
        <h1 class="page-title">
            模块管理</h1>
    </div>
    <ul class="breadcrumb">
        <li><a href="index.html">Home</a> <span class="divider">/</span></li>
        <li class="active">Users</li>
    </ul>
    <div class="container-fluid">
        <div class="row-fluid">
            <div class="btn-toolbar">
                <button class="btn btn-primary">
                    <i class="icon-plus"></i>新增</button>
                <button class="btn">
                    删除</button>
                <div class="btn-group">
                </div>
            </div>
            <div class="well">
                <table class="table table-striped table-bordered table-hover sortable">
                    @Html.Partial("_lazy")
                </table>
                <div class="pagination">
                </div>
            </div>
            <div class="modal small hide fade" id="ModalDel" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
                aria-hidden="true">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                        ×</button>
                    <span class="label label-important">警告</span></h3>
                </div>
                <div class="modal-body">
                    <p class="error-text">
                        你确定要删除用户？ 删除后不可恢复！</p>
                </div>
                <div class="modal-footer">
                    <button class="btn" data-dismiss="modal" aria-hidden="true">
                        取消</button>
                    <button class="btn btn-danger" data-dismiss="modal">
                        确定</button>
                </div>
            </div>
        </div>
    </div>
</div>
@section script{
    <script src="../../Scripts/jquery-1.8.3.min.js" type="text/javascript"></script>
    <script src="../../Scripts/my/jquery.pagination.js" type="text/javascript"></script>
    <script src="../../Scripts/my/bootstrap-modal.js" type="text/javascript"></script>
    <script type="text/javascript">
        jQuery.fn.alternateRowColors = function () {
            $("tbody tr:odd", this).removeClass("even").addClass("odd");
            $("tbody tr:even", this).removeClass("odd").addClass("even");
            return this;
        }

        $(document).ready(function () {
            $("table.sortable").each(function () {
                var $table = $(this);
                $table.alternateRowColors();
                $("th", $table).each(function (column) {
                    var findSortKey;
                    if ($(this).is(".sort-alpha")) {
                        findSortKey = function ($cell) {
                            return $cell.find(".sort-key").text().toUpperCase() + " " + $cell.text().toUpperCase();
                        };
                    }
                    else if ($(this).is(".sort-numeric")) {
                        findSortKey = function ($cell) {
                            var key = parseFloat($cell.text().replace(/^[^\d.]*/, " "));
                            return isNaN(key) ? 0 : key;
                        };
                    }
                    else if ($(this).is(".sort-data")) {
                        findSortKey = function ($cell) {
                            return Date.parse('1 ' + $cell.text());
                        };
                    }

                    if (findSortKey) {
                        $(this).hover(
						function () {
						    $(this).addClass("hover");
						},
						function () {
						    $(this).removeClass("hover");
						}).click(function () {
						    var newDirection = 1;
						    if ($(this).is(".sorted-asc")) {
						        newDirection = -1;
						    }
						    var rows = $table.find("tbody > tr").get();
						    $.each(rows, function (index, row) {
						        row.sortKey = findSortKey($(row).children("td").eq(column));
						    });
						    rows.sort(function (a, b) {
						        if (a.sortKey < b.sortKey) return -newDirection;
						        if (a.sortKey > b.sortKey) return newDirection;
						        return 0;
						    });
						    $.each(rows, function (index, row) {
						        $table.children("tbody").append(row);
						        row.sortKey = null;
						    });
						    $table.find("th").removeClass("sorted-asc").removeClass("sorted-desc");
						    var $sortHead = $table.find('th').filter(":nth-child(" + (column + 1) + ")");
						    if (newDirection == 1) {
						        $sortHead.addClass("sorted-asc");
						    }
						    else {
						        $sortHead.addClass("sorted-desc");
						    }
						    $table.find('td').removeClass("sorted").filter(":nth-child(" + (column + 1) + ")").addClass("sorted");
						    $table.alternateRowColors();
						});
                    };
                });

                $(".pagination").pagination('@ViewBag.totalCount');

                $('.table').find('tr').click(function (e) {
                    if (e.target.className == 'icon-pencil') {
                        var tdLength = $(this).find('td').length;
                        var currentTr, trText;
                        var editArr = [];
                        for (var i = 0; i < tdLength - 1; i++) {
                            currentTr = $(this).find('td').eq(i);
                            trText = currentTr.text();
                            editArr.push(trText);
                            currentTr.html('<input type="text" value="' + trText + '" style="width:150px"/>');
                        }
                        $(this).find('td').eq(tdLength - 1).html('<input type="button" id="edit-sure" class="btn btn-small btn-primary" value="确定" /><input type="button" id="edit-cancel" class="btn btn-small btn-primary" value="取消" />');
                        $('#edit-cancel').on('click', function () {
                            var tds = $(this).parent().parent().find('td');
                            var count = tds.length - 1;
                            for (var i = 0; i < count; i++) {
                                currentTr = tds.eq(i);
                                currentTr.html(editArr[i]);
                            }
                            tds.eq(tds.length - 1).html('<a href="#"><i class="icon-pencil"></i></a><a href="#ModalDel" role="button" data-toggle="modal"><i class="icon-remove"></i></a>');
                        });
                    }
                });
            });
        });	
    </script>
}
